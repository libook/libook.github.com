DJ.namespace("DJ.MBTI");DJ.MBTI.reportLayer=function(j,c,h){var a=$("#evalMBTILayer");a.html(MBTILayerContent);var b="#MBTIPlatform";var i="#shareContent";var g="#DJ-DialogTips";var d=false;$("#MBTIAvatar").attr("src",j);$(i).html(c);a.dialog({width:638,mask:true,title:"展示你的人格魅力",button:"分享并查看报告",defbtncancel:false,oncomplete:function(){if(d){return false}if(typeof h=="function"){var k=$("#shareContent").val();if(DJ.getByteLen(k)>200||k==""){return false}h()}},onabort:function(){},ondisplay:function(){a.html("");$("#interactive-box .close").remove();wordsNum({textArea:"#shareContent",wordsNum:"#MBTITextNum",hideEle:"#inputTextNum",defaText:"",maxWordsNum:100,inCallBack:null});f(function(){$(b).find("input:checkbox").live("click",function(){var k=$("input:checkbox[name='ishare']:checked");if(k.size()>0){$(g).html("");$("#interactive-box .default").html("<span><span>分享并查看报告</span></span>")}else{$(g).html("我不是一个爱分享的人");$("#interactive-box .default").html("<span><span>查看报告</span></span>")}})})}});function f(l){var k="/ce/mbti/openBanding";d=true;$.post(k,function(n){d=false;var o=e(n.openBanding);var m="<span>分享到：</span>";if(o.length>0){m+=o.join("");$(b).html(m);if(l){l()}}},"json")}function e(l){var n=[];var o=l.split(",");var m,k=o.length;for(m=0;m<k;m++){switch(o[m]){case"1":n.push('<label for="iKaixin"><input type="checkbox" name="ishare" value="1" id="iKaixin" /><i class="plat-ico i-kaixin"></i></label>');break;case"2":n.push('<label for="iWeibo"><input type="checkbox" name="ishare" value="2" id="iWeibo" /><i class="plat-ico i-weibo"></i></label>');break;case"0":n.push('<label for="iRenren"><input type="checkbox" name="ishare" value="0" id="iRenren" /><i class="plat-ico i-renren"></i></label>');break;case"4":n.push('<label for="iQqt"><input type="checkbox" name="ishare" value="4" id="iQqt" /><i class="plat-ico i-qqt"></i></label>');break;default:n.push('<label for="iDajie"><input type="checkbox" checked="checked" name="ishare" value="5" id="iDajie" /><i class="plat-ico i-dajie"></i></label>');break}}return n}};function wordsNum(d){var c={textArea:"#inputCont",wordsNum:"#inNumberZs",hideEle:"#hidId",defaText:"",maxWordsNum:140,inCallBack:null};var b=$.extend(c,d);if($(b.textArea).val()==b.defaText){$(b.wordsNum).text("0");$(b.hideEle).val(0)}else{var a=$.fn.getbytelength($(b.textArea).val());$(b.wordsNum).text(a);$(b.hideEle).val(a)}$(b.textArea).focus(function(){if($(this).val()==b.defaText||$(this).val()==""){$(this).val("")}$.fn.countNumber(b.textArea,{scroll:false,numberid:b.maxWordsNum,textareaid:b.wordsNum,effactOn:false});$(this).keyup(function(){var e=$.fn.getbytelength($.trim($(this).val()));if(e>0){$(b.wordsNum).css({color:"#369"})}else{$(b.wordsNum).css({color:"#A8A8A8"})}if(e>b.maxWordsNum){$(b.wordsNum).css({color:"#f60"})}$(b.hideEle).val(e);if(b.inCallBack){b.inCallBack()}})}).focusout(function(){if($(b.textArea).val().length==0){$(this).val(b.defaText).addClass("error-input")}else{$(this).removeClass("error-input")}})}DJ.MBTI.sendMail=function(b){var a=$("#evalMBTILayer-mail");a.html(MBTIMailContent);a.dialog({width:542,mask:true,title:"发送到信箱",button:"分享并查看报告",defbtncancel:false,defbtn:false,oncomplete:function(){},onabort:function(){},ondisplay:function(){a.html("");$(".mailsuggestion").each(function(){$(this).mailList()});$("#buttonSendMail").die().live("click",function(){if(b){b()}})}})};$.extend($.fn,{mailList:function(){var f=this;var c;var a=["@qq.com","@vip.qq.com","@126.com","@163.com"];var e="li-highlight";var b;function d(h,k){var j,n=k.length,l="";var m=h.indexOf("@");var o;var g;var r;var q;var p=[];if(m>-1){o=h.substring(0,m);g=h.substring(m);q=new RegExp("("+g+")");for(j=0;j<n;j++){if(q.test(a[j])){p.push(a[j].replace(q,"<strong>$1</strong>"))}}}else{o=h;p=a}for(j=0;j<p.length;j++){if(j==0){l+='<li class="li-highlight"><strong>'+o+"</strong>"+p[j]+"</li>"}else{l+="<li><strong>"+o+"</strong>"+p[j]+"</li>"}}return l;return['<div class="note g6">可通过键盘上下键选择</div>','<ul class="list">',l,"</ul>"].join("")}if(f.parent().find(".zmmaillist").size()<1){$('<div class="zmmaillist"></div>').insertAfter(f)}f.keyup(function(h){c=f.val();var g=d(c,a);var i=['<div class="note g6">可通过键盘上下键选择</div>','<ul class="list">',g,"</ul>"].join("");if(h.keyCode!=DJ.KEY.RIGHT&&h.keyCode!=DJ.KEY.ENTER&&h.keyCode!=DJ.KEY.ALT&&h.keyCode!=DJ.KEY.CTRL&&h.keyCode!=DJ.KEY.UP&&h.keyCode!=DJ.KEY.DOWN&&h.keyCode!=DJ.KEY.SHIFT){if(c!=""&&g!=""){f.parent().find(".zmmaillist").html(i).show()}else{f.parent().find(".zmmaillist").html("").hide()}}});f.keydown(function(j){var h=f.parent().find(".zmmaillist li");var i=h.length;var g=f.parent().find(".zmmaillist");if(j.keyCode==DJ.KEY.DOWN&&!g.is(":hidden")){h.each(function(k){if($(this).hasClass(e)){b=k}});if(b==i-1){b=-1}if(b+1<i){h.eq(b).removeClass(e);h.eq(b+1).addClass(e)}}if(j.keyCode==DJ.KEY.UP&&!g.is(":hidden")){h.each(function(k){if($(this).hasClass(e)){b=k}});if(b==0){b=i}h.removeClass(e);h.eq(b-1).addClass(e)}if(j.keyCode==DJ.KEY.ENTER||j.keyCode==DJ.KEY.RIGHT){f.val(f.parent().find(".zmmaillist ."+e).text());g.hide()}$(".zmmaillist li").die().live({mouseenter:function(){$(".zmmaillist li").removeClass(e);$(this).addClass(e)},click:function(){f.val($(this).text());f.parent().find(".zmmaillist").hide()}})});f.click(function(g){g.stopPropagation()});$(document).click(function(g){$(".zmmaillist").hide()})}});var startAnswer={question:[],jishu:0,questionTotal:0,answerNum:[],testType:1,totalTime:"",t:"",start:function(){startAnswer.totalTime=Number($(".totaltime").attr("data-time"));$(".btn-start").hide();startAnswer.loadQuestion();$("#js-qaTips").show();startAnswer.addEvent();startAnswer.jishi()},loadQuestion:function(){if(startAnswer.jishu>startAnswer.question.length-1){return}var a=startAnswer.question[startAnswer.jishu];var d=a.picVoList;var f=[];var g;var c;g=(startAnswer.jishu==0)?'style="display:none"':'style="display:block"';c=(startAnswer.jishu==0)?"":"qalabel-s1";$(".qName").text(a.subject);var b=5;var e=(a.subjectType==1)?"lpicUrl":"bpicUrl";if(startAnswer.jishu%b==0){this.loadnextQA(startAnswer.jishu,b,e)}if(a.subjectType==0){f=['<p class="loading">加载中...</p>']}if(a.subjectType==1){f=['<p class="loading">加载中...</p>','<div class="answerlist">','<label for="qa1-1"><input type="radio" name="qa1" id="qa1-1" value="A" /><span class="answer">A</span></label>','<label for="qa1-2"><input type="radio" name="qa1" id="qa1-2" value="B" /><span class="answer">B</span></label>',"</div>",'<div class="avatarlist">','<div class="avatarlist-sub img180">','<cite class="'+c+'" data-answer="A">','<img src="'+d[0].lpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">A</span>","</cite>",'<cite class="'+c+'" data-answer="B">','<img src="'+d[1].lpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">B</span>","</cite>","</div>","</div>"]}if(a.subjectType==2||a.subjectType==3){f=['<p class="loading">加载中...</p>','<div class="answerlist">','<label for="qa1-1"><input type="radio" name="qa1" id="qa1-1" value="A" /><span class="answer">A</span></label>','<label for="qa1-2"><input type="radio" name="qa1" id="qa1-2" value="B" /><span class="answer">B</span></label>','<label for="qa1-3"><input type="radio" name="qa1" id="qa1-3" value="C" /><span class="answer">C</span></label>','<label for="qa1-4"><input type="radio" name="qa1" id="qa1-4" value="D" /><span class="answer">都符合</span></label>','<label for="qa1-5"><input type="radio" name="qa1" id="qa1-5" value="E" /><span class="answer">都不符合</span></label>',"</div>",'<div class="avatarlist">','<div class="avatarlist-sub">',"<cite>",'<img src="'+d[0].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">A</span>","</cite>","<cite>",'<img src="'+d[1].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">B</span>","</cite>","<cite>",'<img src="'+d[2].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">C</span>","</cite>","</div>","</div>"]}if(a.subjectType==4||a.subjectType==5){f=['<p class="loading">加载中...</p>','<div class="answerlist" question-type="boss">','<label for="qa1-1" data-val="0,1"><input type="radio" name="qa1" id="qa1-1" value="A" /><span class="answer">A和B</span></label>','<label for="qa1-2" data-val="0,2"><input type="radio" name="qa1" id="qa1-2" value="B" /><span class="answer">A和C</span></label>','<label for="qa1-3" data-val="0,3"><input type="radio" name="qa1" id="qa1-3" value="C" /><span class="answer">A和D</span></label>','<label for="qa1-4" data-val="1,2"><input type="radio" name="qa1" id="qa1-4" value="D" /><span class="answer">B和C</span></label>','<label for="qa1-5" data-val="1,3"><input type="radio" name="qa1" id="qa1-5" value="E" /><span class="answer">B和D</span></label>','<label for="qa1-6" data-val="2,3"><input type="radio" name="qa1" id="qa1-6" value="F" /><span class="answer">C和D</span></label>','<label for="qa1-7"><input type="radio" name="qa1" id="qa1-7" value="G" /><span class="answer">都可选</span></label>','<label for="qa1-8"><input type="radio" name="qa1" id="qa1-8" value="H" /><span class="answer">无法选择</span></label>',"</div>",'<div class="avatarlist">','<div class="avatarlist-sub">',"<cite>",'<img src="'+d[0].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">A</span>","</cite>","<cite>",'<img src="'+d[1].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">B</span>","</cite>","<cite>",'<img src="'+d[2].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">C</span>","</cite>","<cite>",'<img src="'+d[3].bpicUrl+'" />','<span class="qa-option" '+g+"></span>",'<span class="qa-option-word f16 b" '+g+">D</span>","</cite>","</div>","</div>"]}$(".qalist").html(f.join(""));if(startAnswer.jishu==0){$(".answerlist label").hide()}startAnswer.jishu++},jishi:function(){startAnswer.t=setInterval(function(){var c=Number($(".totaltime").attr("data-time"));if(c<0.1){$(".totaltime").text(0+"''").attr("data-time",0);startAnswer.testEnd();return}var b=c*10-1;var a=(b*10)/startAnswer.totalTime;var d=b%10==0?b/10+".0":b/10;$(".totaltime").text(d+"''").attr("data-time",d);$(".cur-process").css({width:a+"%"})},100)},addEvent:function(){$(".answerlist input[type=radio]").live("click",function(){if($(this).hasClass("disabled")){return false}var c=$(this).closest(".answerlist").siblings(".avatarlist");var b=$(this).parent().index();$(this).parent().addClass("green").siblings().removeClass("green");c.find(".qa-option").removeClass("green").eq(b).addClass("green");var d=$(this).val();var a=Number($.trim($(".cursn").text()))+1;a=(a>startAnswer.question.length-1)?startAnswer.question.length-1:a;if(startAnswer.answerNum.length<startAnswer.question.length){startAnswer.answerNum.push(d)}if(a<startAnswer.questionTotal){$(".cursn").text(a);startAnswer.loadQuestion()}if(startAnswer.answerNum.length>=startAnswer.question.length-1){startAnswer.testEnd()}});$(".avatarlist .qalabel-s1").live("click",function(){var b=$(this).data("answer");var a=Number($.trim($(".cursn").text()))+1;a=(a>startAnswer.question.length-1)?startAnswer.question.length-1:a;if(startAnswer.answerNum.length<startAnswer.question.length){startAnswer.answerNum.push(b)}if(a<startAnswer.questionTotal){$(".cursn").text(a);startAnswer.loadQuestion()}if(startAnswer.answerNum.length>=startAnswer.question.length-1){startAnswer.testEnd()}});$(".answerlist>label").live({mouseenter:function(){var b=$(this).closest(".answerlist").siblings(".avatarlist");var d=b.find(".qa-option");var a=$(this).index();var c=$(this).parent().attr("question-type");d.removeClass("green");if(c=="boss"){try{var f=$(this).attr("data-val").split(",");d.eq(f[0]).addClass("green");d.eq(f[1]).addClass("green")}catch(e){}}else{d.eq(a).addClass("green")}},mouseleave:function(){$(".answerlist>label").removeClass("green");$(".avatarlist .qa-option").removeClass("green")}})},testEnd:function(){clearInterval(startAnswer.t);$(".answerlist input[type=radio]").addClass("disabled");startAnswer.save()},save:function(){var b="/ce/genderIQ/result/"+startAnswer.testType;var a="";switch(startAnswer.testType){case 1:a="的同类对手";break;case 2:a="的职♂生";break;case 3:a="的职♀生";break;case 4:a="的职♂老板";break;case 5:a="的职♀老板";break}$.post(b,{answers:startAnswer.answerNum.join(",")},function(e){if(e.status<0){$(".time-to .zj").html(startAnswer.totalTime+"秒内，您共回答了0道题<br />答题速度打败了0%的同类对手");$("#timedTo").dialog({width:574,mask:true,title:"",button:"重测一次",defbtncancel:false,oncomplete:function(){},onabort:function(){var f="http://www.dajie.com/ce/genderIQ";window.location.href=f}});$(".time-to .viewResult").html("<span><span>重测一次</span></span>");$(".time-to .viewResult").live("click",function(){var f="http://www.dajie.com/ce/genderIQ";window.location.href=f});return}if(e.status==0){var d=(startAnswer.totalTime*10-Number($(".totaltime").attr("data-time"))*10)/10;var c=startAnswer.answerNum.length>101?101:startAnswer.answerNum.length;$(".time-to .zj").html(d+"秒内，您共回答了"+c+"道题<br />答题速度打败了"+e.beat+a);$("#timedTo").dialog({width:574,mask:true,title:"",button:"查看测试结果",defbtncancel:false,oncomplete:function(){},onabort:function(){window.location.href="/ce/genderIQ/query/"+e.resultId}});$(".time-to .viewResult").live("click",function(){var f="/ce/genderIQ/query/"+e.resultId;window.location.href=f})}},"json")},loadnextQA:function(h,g,b){var l=startAnswer.question.length;var e=h;var k=(h+g)>l?l:h+g;var a=[];var f,d,c;for(f=e;f<k;f++){for(d=0,c=startAnswer.question[f].picVoList.length;d<c;d++){a[a.length]=startAnswer.question[f].picVoList[d][b]}}this.beforeLoadImg(a)},beforeLoadImg:function(d){var c=[];var b,a;if(!d||!d.length){return}if(typeof d=="string"){c[0]=new Image();c[0].src=d}else{for(b=0,a=d.length;b<a;b++){c[b]=new Image();c[b].src=d[b]}}}};var shareTo={rid:"",init:function(){$(".xs-result .zan").live("click",function(){var b=$(this).attr("resultId");$.post("/ce/genderIQ/praise",{resultId:b},function(c){},"json");$(this).addClass("zaned").removeClass("zan");return false});var a=$("#xianBai").html();$("#xianBaiBtn").live("click",function(){$("#xianBai").html(a);if(!$(this).hasClass("binding-btn")){shareTo.rid=$(this).attr("resultId");$("#xianBai").dialog({width:638,mask:true,title:"显摆一下",button:"显摆一下",defbtncancel:false,customClass:"xianbaiLayer",oncomplete:function(){},onabort:function(){},ondisplay:function(){$(".xianbaiLayer .buttons .default").die().unbind();$("#xianBai").html("")}});$(".xianbaiLayer .default").live("click",function(){shareTo.sendShare()});shareTo.checkPlat(function(){$(".share-to>label").live("click",function(){var c=$(this).find("input[type=checkbox]");if(c.is(":checked")){c.removeAttr("checked")}else{c.attr("checked","checked")}});$(".share-to input[type=checkbox]").live("click",function(c){c.stopPropagation()})});shareTo.wordsNum({textArea:".xianbaiLayer #shareContentIn",wordsNum:".xianbaiLayer #currNum",hideEle:".xianbaiLayer #hideNum",defaText:"",maxWordsNum:100,inCallBack:null});$(".xianbaiLayer .share-to>cite").die().live("click",function(){var c=$(this).find("input[name=ishare]");c.is(":checked")?c.removeAttr("checked"):c.attr("checked","checked");b()});$(".xianbaiLayer input[name=ishare]").die().live("click",function(){b()});function b(){var c=$(".xianbaiLayer input[name=ishare]:checked").length;c<1?$(".xianbaiLayer .noYongQi").show():$(".xianbaiLayer .noYongQi").hide()}$(".xianbaiLayer .noYongQi").live("click",function(){shareTo.closeLayer();return false});return false}})},sendShare:function(){var b="/ce/genderIQ/share/"+shareTo.rid;var c=$.trim($(".xianbaiLayer #shareContentIn").val());var d=$(".xianbaiLayer input[name='ishare']:checked");var f=[];var a="";var e=$(".xianbaiLayer #hideNum").val();if(e<1){shareTo.tip("请输入要显摆的内容，这样可以让自己更骄傲！");$(".xianbaiLayer #shareContentIn").focus();return}if(e>100){shareTo.tip("内容不能超过100字，缩减一下吧！");$(".xianbaiLayer #shareContentIn").focus();return}d.each(function(){f.push($(this).val())});if(f.length>0){a=f.join(",");$.post(b,{shareType:a,shareContent:c},function(g){if(g.code==1){shareTo.success()}},"json")}else{shareTo.tip("至少要勾选一个平台才可以显摆哦！");return}shareTo.closeLayer()},success:function(){$("#successTips").dialog({width:310,mask:true,title:"提示",button:"确定",defbtncancel:false,customClass:"successTips",oncomplete:function(){},onabort:function(){},ondisplay:function(){}});setTimeout(function(){$(".successTips,#interactive-mask").fadeOut(150,function(){$(".successTips,#interactive-mask").remove()})},2000)},tip:function(a){var b=$(".xianbaiLayer .error-tip");if(b.is(":visible")){return}b.fadeIn(100).text(a);setTimeout(function(){b.fadeOut(150)},2500)},wordsNum:function(d){var c={textArea:"#inputCont",wordsNum:"#inNumberZs",hideEle:"#hidId",defaText:"",maxWordsNum:140,inCallBack:null};var b=$.extend(c,d);if($(b.textArea).val()==b.defaText){$(b.wordsNum).text("0");$(b.hideEle).val(0)}else{var a=$.fn.getbytelength($(b.textArea).val());$(b.wordsNum).text(a);$(b.hideEle).val(a)}$(b.textArea).focus(function(){if($(this).val()==b.defaText||$(this).val()==""){$(this).val("")}$.fn.countNumber(b.textArea,{scroll:false,numberid:b.maxWordsNum,textareaid:b.wordsNum,effactOn:false});$(this).keyup(function(){var e=$.fn.getbytelength($.trim($(this).val()));if(e>0){$(b.wordsNum).css({color:"#1357A2"})}else{$(b.wordsNum).css({color:"#A8A8A8"})}if(e>b.maxWordsNum){$(b.wordsNum).css({color:"#f86"})}$(b.hideEle).val(e);if(b.inCallBack){b.inCallBack()}})}).focusout(function(){if($(b.textArea).val().length==0){$(this).val(b.defaText).addClass("error-input")}else{$(this).removeClass("error-input")}})},closeLayer:function(){$("#interactive-mask,#interactive-box").remove()},checkPlat:function(b){var a="/ce/mbti/openBanding";$.post(a,function(d){var e=shareTo.getPlat(d.openBanding);var c="<span>分享到：</span>";if(e.length>0){c+=e.join("");$(".rec-descripte .share-to").html(c);if(b){b()}}},"json")},getPlat:function(b){var d=[];var e=b.split(",");var c,a=e.length;for(c=0;c<a;c++){switch(e[c]){case"1":d.push('<cite for="iKaixin"><input type="checkbox" checked="checked" name="ishare" value="1" id="iKaixin" /><i class="ico-img i-kaixin"></i></cite>');break;case"2":d.push('<cite for="iWeibo"><input type="checkbox" checked="checked" name="ishare" value="2" id="iWeibo" /><i class="ico-img i-weibo"></i></cite>');break;case"0":d.push('<cite for="iRenren"><input type="checkbox" checked="checked" name="ishare" value="0" id="iRenren" /><i class="ico-img i-renren"></i></cite>');break;case"4":d.push('<cite for="iQqt"><input type="checkbox" checked="checked" name="ishare" value="4" id="iQqt" /><i class="ico-img i-qqt"></i></cite>');break;default:d.push('<cite for="iDajie"><input type="checkbox" checked="checked" name="ishare" value="5" id="iDajie" /><i class="ico-img i-dajie"></i></cite>');break}}return d}};$(".bindplat .binding-btn,.button-area .binding-btn").live("click",function(){var a=$(this).attr("socialnetwork");if(a=="sina"){window.open("http://www.dajie.com/account/"+a+"/login?d.cb=r1","openuserlogin")}else{window.open("http://www.dajie.com/account/"+a+"/login?d.cb=1","openuserlogin")}});